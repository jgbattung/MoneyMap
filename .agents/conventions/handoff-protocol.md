# Handoff Protocol

> Shared conventions for the Gemini (Architect) and Claude Code (Builder) collaboration.
> Both agents must reference this file for spec format, tracking, and Definition of Done.

## Roles

- **Gemini (Architect):** Research, planning, UI/UX design, architecture decisions. Produces specification files. Does NOT write executable source code.
- **Claude Code (Builder):** Executes specs, writes code, runs tests, and reports back. Does NOT make unilateral architectural decisions outside the spec.

## Specification Format

All specs produced by Gemini must be saved in `/docs/` and follow this naming convention:

- `/docs/[feature]-spec.md` — Feature or design specification (serves as Context/Requirements)
- `/docs/[feature]-plan.xml` — Actionable, atomic task plans in strict XML format for Claude Code
- `/docs/[feature]-verification.md` — Verification document generated by Claude Code after execution
- `/docs/architecture-spec.md` — System-wide architectural decisions

Specs must be **highly detailed, perfectly structured in Markdown, and unambiguous** so Claude Code can execute without guesswork.

## Definition of Done (Specs)

A specification is not complete until it includes all of the following:

1. **Clear Objectives & Scope** — What is being solved, and what is explicitly *out* of scope.
2. **Actionable Implementation Steps** — A breakdown of the exact changes Claude Code needs to make.
3. **Verification/Test Plan** — Explicit instructions on how to verify the work (e.g., "write a unit test for X", "verify the API returns 200").
4. **Contextual Pointers** — References to related specs or design standards (e.g., linking to `design-spec.md` for UI tasks) to avoid duplicating information.

## Task Tracking & Execution

When Gemini produces an execution plan (`-plan.xml`), it must use strict XML blocks for each task to remove ambiguity:

```xml
<task>
  <name>Display Name of Task</name>
  <action>Explicit instruction of what files to modify and how</action>
  <verify>Explicit command or step to test the change</verify>
</task>
```

When Claude Code executes a `-plan.xml`:

1. **Read the full `-spec.md`** first to understand the context before writing any code.
2. **Execute tasks sequentially or in parallel** depending on dependencies.
3. **Atomic Commits:** CREATE A SEPARATE GIT COMMIT for *each* completed `<task>`. Do NOT bundle all changes into one large commit at the end. Use a message like `feat: <task name>`. Commit immediately upon passing verification.
4. **Database Safety:** If a task involves changing the Prisma schema, you must NOT run `npx prisma migrate` or any other DB commands. You must stop and ask the user to run the migration manually.
5. **Generate Verification Document:** Upon completing all tasks, Claude Code must create `/docs/[feature]-verification.md` detailing the test results or manual steps taken to prove the feature works.
6. **Do not skip items** — if a task is blocked, halt execution and note the blocker in the verification document.

This guarantees granular rollbacks if an execution step fails, and allows Gemini to quickly verify the execution during the Review phase.

## Key Docs Management

When Gemini creates a new spec file, it must also add a reference to it under the `## Key Docs` section in `CLAUDE.md`. If that section does not exist, Gemini must create it.

## Archiving Completed & Skipped Specs

When a feature is fully implemented and verified, move its spec and task files from `/docs/` to `/docs/archive/`. Do not delete specs — archived specs serve as historical context for future planning.

**Skipped/Canceled Specs:** If a planned spec is skipped or canceled by the user before execution, it MUST also be moved to `/docs/archive/`. This ensures Claude Code does not accidentally find and execute it later. You can append a note like `(Skipped)` to the top of the archived file for clarity.
